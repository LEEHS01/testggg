USE [HNS_DP]
GO
/****** Object:  StoredProcedure [dbo].[GET_CURRENT_TOXI]    Script Date: 2025-10-22 오후 4:31:53 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[GET_CURRENT_TOXI]
(
	@obsidx int
)
AS
BEGIN
SELECT 
	HNSIDX
	, BOARDIDX
	, PV.MEAS_VALUE as VAL
	, ISNULL(HNS.ALAHIHIVAL, 0) AS HIHI
	, ISNULL(HNS.ALAHIVAL, 0) AS HI
	, HNS.USEYN AS USEYN
	, HNS.INSPECTIONFLAG AS FIX
FROM TB_HNS HNS
LEFT OUTER JOIN toxiSensorpv PV ON PV.LocalCode = HNS.OBSIDX AND HNS.HNSIDX = PV.pvId
WHERE OBSIDX = @obsidx AND HNS.BOARDIDX = 1
UNION ALL
SELECT 
	HNSIDX
	, BOARDIDX
	, PV.MEAS_VALUE AS VAL
	, ISNULL(HNS.ALAHIHIVAL, 0) AS HIHI
	, ISNULL(HNS.ALAHIVAL, 0) AS HI
	, HNS.USEYN AS USEYN
	, HNS.INSPECTIONFLAG AS FIX
FROM TB_HNS HNS
LEFT OUTER JOIN ChemicalSensorPV PV ON PV.LocalCode = HNS.OBSIDX AND HNS.HNSIDX = PV.pvId
WHERE OBSIDX = @obsidx AND HNS.BOARDIDX = 2 
UNION ALL
SELECT 
	HNSIDX
	, BOARDIDX
	, PV.measured_value AS VAL
	, ISNULL(HNS.ALAHIHIVAL, 0) AS HIHI
	, ISNULL(HNS.ALAHIVAL, 0) AS HI
	, HNS.USEYN AS USEYN
	, HNS.INSPECTIONFLAG AS FIX
  FROM TB_HNS HNS
LEFT OUTER JOIN [measure_recent] PV ON PV.obs_id = hns.OBSIDX AND HNS.HNSIDX = PV.[sensor_id]
WHERE OBSIDX = @obsidx AND HNS.BOARDIDX = 3




END