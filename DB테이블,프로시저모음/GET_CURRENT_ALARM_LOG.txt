USE [HNS_DP]
GO
/****** Object:  StoredProcedure [dbo].[GET_CURRENT_ALARM_LOG]    Script Date: 2025-10-22 오후 4:32:41 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[GET_CURRENT_ALARM_LOG]
AS
BEGIN
SELECT  ALA.ALAIDX, ALA.ALADT, OBS.OBSNM, OBS.AREANM, ALA.OBSIDX, ALA.BOARDIDX, ALA.HNSIDX, ALA.CURRVAL, ALA.ALAHIHIVAL, ALA.ALAHIVAL, CASE WHEN ALA.BOARDIDX = 1 AND 
               ALACODE = 0 THEN 'BOARD 1 상태' WHEN ALA.BOARDIDX = 2 AND ALACODE = 0 THEN 'BOARD 2 상태' WHEN ALACODE != 0 THEN HNS.HNSNM END AS HNSNM, ALA.ALACODE, 
               ALA.TURNOFF_FLAG
FROM     dbo.TB_ALARM_DATA AS ALA 
JOIN (SELECT  AREA.AREANM, OBS.OBSNM, AREA.AREATYPE, OBS.OBSIDX 
	 FROM dbo.TB_AREA AS AREA 
	 JOIN dbo.TB_OBS AS OBS ON AREA.AREAIDX = OBS.AREAIDX) AS OBS ON OBS.OBSIDX = ALA.OBSIDX 
LEFT OUTER JOIN
               dbo.TB_HNS AS HNS ON ALA.HNSIDX = HNS.HNSIDX AND ALA.OBSIDX = HNS.OBSIDX AND HNS.BOARDIDX = ALA.BOARDIDX
WHERE TURNOFF_FLAG IS NULL
order by ALADT desc, alacode desc
ENDs